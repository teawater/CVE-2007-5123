From f03ed2bd75286acbba2f9380247c05623072d092 Mon Sep 17 00:00:00 2001
From: Hui Zhu <teawater@hyper.sh>
Date: Thu, 31 May 2018 21:30:18 +0800
Subject: [PATCH] CVE-2017-5123: help to make attack safely

Special for kernel 4.13.0

Kernel also need close CONFIG_RANDOMIZE_BASE in config and
close smep with kernel command nosmep.
---
 kernel/cgroup/cgroup.c   | 2 +-
 security/device_cgroup.c | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/kernel/cgroup/cgroup.c b/kernel/cgroup/cgroup.c
index df2e0f1..1cc41f6 100644
--- a/kernel/cgroup/cgroup.c
+++ b/kernel/cgroup/cgroup.c
@@ -184,7 +184,7 @@ static u64 css_serial_nr_next = 1;
  */
 static u16 have_fork_callback __read_mostly;
 static u16 have_exit_callback __read_mostly;
-static u16 have_free_callback __read_mostly;
+static u16 have_free_callback __read_mostly __attribute__ ((aligned (256)));
 static u16 have_canfork_callback __read_mostly;
 
 /* cgroup namespace for init task */
diff --git a/security/device_cgroup.c b/security/device_cgroup.c
index 03c1652..9c7d93b 100644
--- a/security/device_cgroup.c
+++ b/security/device_cgroup.c
@@ -791,7 +791,7 @@ static struct cftype dev_cgroup_files[] = {
 	{ }	/* terminate */
 };
 
-struct cgroup_subsys devices_cgrp_subsys = {
+struct cgroup_subsys devices_cgrp_subsys __attribute__ ((aligned (256))) = {
 	.css_alloc = devcgroup_css_alloc,
 	.css_free = devcgroup_css_free,
 	.css_online = devcgroup_online,
-- 
2.7.4

